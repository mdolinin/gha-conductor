{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "http://example.com/example.json",
    "type": "object",
    "title": "The root schema",
    "description": "The root schema comprises the entire JSON document.",
    "default": {},
    "examples": [
        {
            "moduleName": "example-a",
            "teamNamespace": "domain-a",
            "sharedParams": {
                "ROOT_DIR": "namespaces/domain-a"
            },
            "defaultFileChangeTrigger": [
                "namespaces/domain-a/projects/example-a/**"
            ],
            "onPullRequest": [
                {
                    "name": "build",
                    "pipelineRef": {
                        "name": "generic-job",
                        "ref": "main"
                    },
                    "pipelineRunValues": {
                        "params": {
                            "COMMAND": "make build"
                        }
                    },
                    "triggerConditions": {
                        "fileChangesMatchAny": [
                            "namespaces/domain-a/projects/example-a/**"
                        ]
                    }
                },
                {
                    "name": "test",
                    "pipelineRef": {
                        "name": "generic-job"
                    },
                    "pipelineRunValues": {
                        "params": {
                            "COMMAND": "make test"
                        }
                    },
                    "triggerConditions": {
                        "fileChangesMatchAny": [
                            "namespaces/domain-a/projects/example-a/tests/**"
                        ]
                    }
                }
            ],
            "onBranchMerge": [
                {
                    "name": "release",
                    "pipelineRef": {
                        "name": "generic-job"
                    },
                    "pipelineRunValues": {
                        "params": {
                            "COMMAND": "make release"
                        }
                    },
                    "triggerConditions": {
                        "destinationBranchMatchesAny": [
                            "main"
                        ],
                        "fileChangesMatchAny": [
                            "namespaces/domain-a/projects/example-a/**"
                        ]
                    }
                }
            ]
        }
    ],
    "required": [
        "moduleName",
        "teamNamespace",
        "sharedParams",
        "defaultFileChangeTrigger",
        "onPullRequest",
        "onBranchMerge"
    ],
    "properties": {
        "moduleName": {
            "$id": "#/properties/moduleName",
            "type": "string",
            "title": "The moduleName schema",
            "description": "moduleName must be unique across the whole mono repo",
            "default": "",
            "examples": [
                "example-a"
            ]
        },
        "teamNamespace": {
            "$id": "#/properties/teamNamespace",
            "type": "string",
            "title": "The teamNamespace schema",
            "description": "teamNamespace must be unique across the whole mono repo",
            "default": "",
            "examples": [
                "domain-a"
            ]
        },
        "sharedParams": {
            "$id": "#/properties/sharedParams",
            "type": "object",
            "title": "The sharedParams schema",
            "description": "Params shared across all hooks in the .gha.yaml file.",
            "default": {},
            "examples": [
                {
                    "ROOT_DIR": "namespaces/domain-a"
                }
            ],
            "additionalProperties": true
        },
        "defaultFileChangeTrigger": {
            "$id": "#/properties/defaultFileChangeTrigger",
            "type": "array",
            "title": "The defaultFileChangeTrigger schema",
            "description": "List of files that are tracked under defaultFileChangeTrigger variable to trigger pipeline based on the event.",
            "default": [],
            "examples": [
                [
                    "namespaces/domain-a/projects/example-a/**"
                ]
            ],
            "additionalItems": true,
            "items": {
                "$id": "#/properties/defaultFileChangeTrigger/items",
                "anyOf": [
                    {
                        "$id": "#/properties/defaultFileChangeTrigger/items/anyOf/0",
                        "type": "string",
                        "title": "The first anyOf schema",
                        "description": "List of files that are tracked under defaultFileChangeTrigger variable to trigger pipeline based on the event.",
                        "default": "",
                        "examples": [
                            "namespaces/domain-a/projects/example-a/**",
                            "namespaces/domain-a/projects/example-b/test/test.sh"
                        ]
                    }
                ]
            }
        },
        "onPullRequest": {
            "$id": "#/properties/onPullRequest",
            "type": "array",
            "title": "The onPullRequest schema",
            "description": "Workflows to run on Github pull request open, reopened, synchronize events",
            "default": [],
            "examples": [
                [
                    {
                        "name": "build",
                        "pipelineRef": {
                            "name": "generic-job"
                        },
                        "pipelineRunValues": {
                            "params": {
                                "COMMAND": "make build"
                            }
                        },
                        "triggerConditions": {
                            "fileChangesMatchAny": [
                                "namespaces/domain-a/projects/example-a/**"
                            ]
                        }
                    },
                    {
                        "name": "test",
                        "pipelineRef": {
                            "name": "generic-job"
                        },
                        "pipelineRunValues": {
                            "params": {
                                "COMMAND": "make test"
                            }
                        },
                        "triggerConditions": {
                            "fileChangesMatchAny": [
                                "namespaces/domain-a/projects/example-a/tests/test.sh"
                            ]
                        }
                    }
                ]
            ],
            "additionalItems": true,
            "items": {
                "$id": "#/properties/onPullRequest/items",
                "anyOf": [
                    {
                        "$id": "#/properties/onPullRequest/items/anyOf/0",
                        "type": "object",
                        "title": "On pull request hook schema",
                        "description": "Workflow to run on Github pull request open, reopened, synchronize events",
                        "default": {},
                        "examples": [
                            {
                                "name": "build",
                                "pipelineRef": {
                                    "name": "generic-job"
                                },
                                "pipelineRunValues": {
                                    "params": {
                                        "COMMAND": "make build"
                                    }
                                },
                                "triggerConditions": {
                                    "fileChangesMatchAny": [
                                        "namespaces/domain-a/projects/example-a/**"
                                    ]
                                }
                            }
                        ],
                        "required": [
                            "name",
                            "pipelineRef",
                            "pipelineRunValues",
                            "triggerConditions"
                        ],
                        "properties": {
                            "name": {
                                "$id": "#/properties/onPullRequest/items/anyOf/0/properties/name",
                                "type": "string",
                                "title": "Hook name schema",
                                "description": "name of the hook, must be unique in the .gha.yaml file",
                                "default": "",
                                "examples": [
                                    "build-and-test"
                                ]
                            },
                            "pipelineRef": {
                                "$id": "#/properties/onPullRequest/items/anyOf/0/properties/pipelineRef",
                                "type": "object",
                                "title": "The pipelineRef schema",
                                "description": "Reference to the GHA workflow to run",
                                "default": {},
                                "examples": [
                                    {
                                        "name": "generic-job",
                                        "ref": "main"
                                    }
                                ],
                                "required": [
                                    "name"
                                ],
                                "properties": {
                                    "name": {
                                        "$id": "#/properties/onPullRequest/items/anyOf/0/properties/pipelineRef/properties/name",
                                        "type": "string",
                                        "title": "GHA workflow name schema",
                                        "description": "GHA workflow name to run, w/o file extension",
                                        "default": "",
                                        "examples": [
                                            "generic-job"
                                        ]
                                    },
                                    "ref": {
                                        "$id": "#/properties/onPullRequest/items/anyOf/0/properties/pipelineRef/properties/ref",
                                        "type": "string",
                                        "title": "The ref schema",
                                        "description": "branch name for GHA workflow if different from default",
                                        "default": "",
                                        "examples": [
                                            "master",
                                            "main"
                                        ]
                                    }
                                },
                                "additionalProperties": true
                            },
                            "pipelineRunValues": {
                                "$id": "#/properties/onPullRequest/items/anyOf/0/properties/pipelineRunValues",
                                "type": "object",
                                "title": "The pipelineRunValues schema",
                                "description": "Values to pass to the GHA workflow",
                                "default": {},
                                "examples": [
                                    {
                                        "params": {
                                            "COMMAND": "make build"
                                        }
                                    }
                                ],
                                "required": [
                                    "params"
                                ],
                                "properties": {
                                    "params": {
                                        "$id": "#/properties/onPullRequest/items/anyOf/0/properties/pipelineRunValues/properties/params",
                                        "type": "object",
                                        "title": "The params schema",
                                        "description": "Parameters to pass to the GHA workflow",
                                        "default": {},
                                        "examples": [
                                            {
                                                "COMMAND": "make build"
                                            }
                                        ],
                                        "additionalProperties": true
                                    }
                                },
                                "additionalProperties": true
                            },
                            "triggerConditions": {
                                "$id": "#/properties/onPullRequest/items/anyOf/0/properties/triggerConditions",
                                "type": "object",
                                "title": "The triggerConditions schema",
                                "description": "Conditions to trigger the GHA workflow",
                                "default": {},
                                "examples": [
                                    {
                                        "fileChangesMatchAny": [
                                            "namespaces/domain-a/projects/example-a/**"
                                        ]
                                    }
                                ],
                                "required": [
                                    "fileChangesMatchAny"
                                ],
                                "properties": {
                                    "fileChangesMatchAny": {
                                        "$id": "#/properties/onPullRequest/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny",
                                        "type": "array",
                                        "title": "The fileChangesMatchAny schema",
                                        "description": "List of globs that will trigger the GHA workflow, if files change in the PR match any of these globs",
                                        "default": [],
                                        "examples": [
                                            [
                                                "namespaces/domain-a/projects/example-a/**"
                                            ]
                                        ],
                                        "additionalItems": true,
                                        "items": {
                                            "$id": "#/properties/onPullRequest/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny/items",
                                            "anyOf": [
                                                {
                                                    "$id": "#/properties/onPullRequest/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny/items/anyOf/0",
                                                    "type": "string",
                                                    "title": "File change matcher schema",
                                                    "description": "Glob to match files in the PR",
                                                    "default": "",
                                                    "examples": [
                                                        "namespaces/domain-a/projects/example-a/**"
                                                    ]
                                                }
                                            ]
                                        }
                                    }
                                },
                                "additionalProperties": true
                            }
                        },
                        "additionalProperties": true
                    }
                ]
            }
        },
        "onBranchMerge": {
            "$id": "#/properties/onBranchMerge",
            "type": "array",
            "title": "The onBranchMerge schema",
            "description": "Workflow to run on Github branch merge event",
            "default": [],
            "examples": [
                [
                    {
                        "name": "release",
                        "pipelineRef": {
                            "name": "generic-job",
                            "ref": "main"
                        },
                        "pipelineRunValues": {
                            "params": {
                                "COMMAND": "make release"
                            }
                        },
                        "triggerConditions": {
                            "destinationBranchMatchesAny": [
                                "main"
                            ],
                            "fileChangesMatchAny": [
                                "namespaces/domain-a/projects/example-a/**"
                            ]
                        }
                    }
                ]
            ],
            "additionalItems": true,
            "items": {
                "$id": "#/properties/onBranchMerge/items",
                "anyOf": [
                    {
                        "$id": "#/properties/onBranchMerge/items/anyOf/0",
                        "type": "object",
                        "title": "On branch merge hook schema",
                        "description": "Workflow to run on Github branch merge event",
                        "default": {},
                        "examples": [
                            {
                                "name": "release",
                                "pipelineRef": {
                                    "name": "generic-job",
                                    "ref": "main"
                                },
                                "pipelineRunValues": {
                                    "params": {
                                        "COMMAND": "make release"
                                    }
                                },
                                "triggerConditions": {
                                    "destinationBranchMatchesAny": [
                                        "main"
                                    ],
                                    "fileChangesMatchAny": [
                                        "namespaces/domain-a/projects/example-a/**"
                                    ]
                                }
                            }
                        ],
                        "required": [
                            "name",
                            "pipelineRef",
                            "pipelineRunValues",
                            "triggerConditions"
                        ],
                        "properties": {
                            "name": {
                                "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/name",
                                "type": "string",
                                "title": "Hook name schema",
                                "description": "name of the hook, must be unique in the .gha.yaml file",
                                "default": "",
                                "examples": [
                                    "release"
                                ]
                            },
                            "pipelineRef": {
                                "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/pipelineRef",
                                "type": "object",
                                "title": "The pipelineRef schema",
                                "description": "Reference to the GHA workflow to run",
                                "default": {},
                                "examples": [
                                    {
                                        "name": "generic-job"
                                    }
                                ],
                                "required": [
                                    "name"
                                ],
                                "properties": {
                                    "name": {
                                        "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/pipelineRef/properties/name",
                                        "type": "string",
                                        "title": "GHA workflow name schema",
                                        "description": "GHA workflow name to run, w/o file extension",
                                        "default": "",
                                        "examples": [
                                            "generic-job"
                                        ]
                                    },
                                    "ref": {
                                        "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/pipelineRef/properties/ref",
                                        "type": "string",
                                        "title": "The ref schema",
                                        "description": "branch name for GHA workflow if different from default",
                                        "default": "",
                                        "examples": [
                                            "master",
                                            "main"
                                        ]
                                    }
                                },
                                "additionalProperties": true
                            },
                            "pipelineRunValues": {
                                "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/pipelineRunValues",
                                "type": "object",
                                "title": "The pipelineRunValues schema",
                                "description": "Values to pass to the GHA workflow",
                                "default": {},
                                "examples": [
                                    {
                                        "params": {
                                            "COMMAND": "make release"
                                        }
                                    }
                                ],
                                "required": [
                                    "params"
                                ],
                                "properties": {
                                    "params": {
                                        "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/pipelineRunValues/properties/params",
                                        "type": "object",
                                        "title": "The params schema",
                                        "description": "Parameters to pass to the GHA workflow",
                                        "default": {},
                                        "examples": [
                                            {
                                                "COMMAND": "make release"
                                            }
                                        ],
                                        "additionalProperties": true
                                    }
                                },
                                "additionalProperties": true
                            },
                            "triggerConditions": {
                                "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/triggerConditions",
                                "type": "object",
                                "title": "The triggerConditions schema",
                                "description": "Conditions to trigger the GHA workflow",
                                "default": {},
                                "examples": [
                                    {
                                        "destinationBranchMatchesAny": [
                                            "main"
                                        ],
                                        "fileChangesMatchAny": [
                                            "namespaces/domain-a/projects/example-a/**"
                                        ]
                                    }
                                ],
                                "required": [
                                    "destinationBranchMatchesAny",
                                    "fileChangesMatchAny"
                                ],
                                "properties": {
                                    "destinationBranchMatchesAny": {
                                        "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/triggerConditions/properties/destinationBranchMatchesAny",
                                        "type": "array",
                                        "title": "The destinationBranchMatchesAny schema",
                                        "description": "List of the target branches where the changes are merged.",
                                        "default": [],
                                        "examples": [
                                            [
                                                "main",
                                                "master"
                                            ]
                                        ],
                                        "additionalItems": true,
                                        "items": {
                                            "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/triggerConditions/properties/destinationBranchMatchesAny/items",
                                            "anyOf": [
                                                {
                                                    "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/triggerConditions/properties/destinationBranchMatchesAny/items/anyOf/0",
                                                    "type": "string",
                                                    "title": "Target branch name schema",
                                                    "description": "Name of the target branch where the changes are merged.",
                                                    "default": "",
                                                    "examples": [
                                                        "main"
                                                    ]
                                                }
                                            ]
                                        }
                                    },
                                    "fileChangesMatchAny": {
                                        "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny",
                                        "type": "array",
                                        "title": "The fileChangesMatchAny schema",
                                        "description": "List of globs that will trigger the GHA workflow, if files change in the PR match any of these globs",
                                        "default": [],
                                        "examples": [
                                            [
                                                "namespaces/domain-a/projects/example-a/**",
                                                "namespaces/domain-a/projects/example-b/test/test.sh"
                                            ]
                                        ],
                                        "additionalItems": true,
                                        "items": {
                                            "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny/items",
                                            "anyOf": [
                                                {
                                                    "$id": "#/properties/onBranchMerge/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny/items/anyOf/0",
                                                    "type": "string",
                                                    "title": "File change matcher schema",
                                                    "description": "Glob to match files in the PR",
                                                    "default": "",
                                                    "examples": [
                                                        "namespaces/domain-a/projects/example-a/**"
                                                    ]
                                                }
                                            ]
                                        }
                                    }
                                },
                                "additionalProperties": true
                            }
                        },
                        "additionalProperties": true
                    }
                ]
            }
        },
        "onPullRequestClose": {
            "$id": "#/properties/onPullRequestClose",
            "type": "array",
            "title": "The onPullRequestClose schema",
            "description": "Workflows to run on Github pull request close event, but not merged.",
            "default": [],
            "examples": [
                [
                    {
                        "name": "cleanup",
                        "pipelineRef": {
                            "name": "generic-job",
                            "ref": "main"
                        },
                        "pipelineRunValues": {
                            "params": {
                                "COMMAND": "make clean"
                            }
                        },
                        "triggerConditions": {
                            "fileChangesMatchAny": [
                                "namespaces/domain-a/projects/example-a/**"
                            ]
                        }
                    }
                ]
            ],
            "additionalItems": true,
            "items": {
                "$id": "#/properties/onPullRequestClose/items",
                "anyOf": [
                    {
                        "$id": "#/properties/onPullRequestClose/items/anyOf/0",
                        "type": "object",
                        "title": "On pull request close hook schema",
                        "description": "Workflow to run on Github pull request close event, but not merged.",
                        "default": {},
                        "examples": [
                            {
                                "name": "cleanup",
                                "pipelineRef": {
                                    "name": "generic-job",
                                    "ref": "main"
                                },
                                "pipelineRunValues": {
                                    "params": {
                                        "COMMAND": "make clean"
                                    }
                                },
                                "triggerConditions": {
                                    "fileChangesMatchAny": [
                                        "namespaces/domain-a/projects/example-a/**"
                                    ]
                                }
                            }
                        ],
                        "required": [
                            "name",
                            "pipelineRef",
                            "pipelineRunValues",
                            "triggerConditions"
                        ],
                        "properties": {
                            "name": {
                                "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/name",
                                "type": "string",
                                "title": "Hook name schema",
                                "description": "name of the hook, must be unique in the .gha.yaml file",
                                "default": "",
                                "examples": [
                                    "cleanup"
                                ]
                            },
                            "pipelineRef": {
                                "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/pipelineRef",
                                "type": "object",
                                "title": "The pipelineRef schema",
                                "description": "Reference to the GHA workflow to run",
                                "default": {},
                                "examples": [
                                    {
                                        "name": "generic-job",
                                        "ref": "main"
                                    }
                                ],
                                "required": [
                                    "name"
                                ],
                                "properties": {
                                    "name": {
                                        "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/pipelineRef/properties/name",
                                        "type": "string",
                                        "title": "GHA workflow name schema",
                                        "description": "GHA workflow name to run, w/o file extension",
                                        "default": "",
                                        "examples": [
                                            "generic-job"
                                        ]
                                    },
                                    "ref": {
                                        "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/pipelineRef/properties/ref",
                                        "type": "string",
                                        "title": "The ref schema",
                                        "description":"branch name for GHA workflow if different from default",
                                        "default": "",
                                        "examples": [
                                            "master",
                                            "main"
                                        ]
                                    }
                                },
                                "additionalProperties": true
                            },
                            "pipelineRunValues": {
                                "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/pipelineRunValues",
                                "type": "object",
                                "title": "The pipelineRunValues schema",
                                "description": "Values to pass to the GHA workflow",
                                "default": {},
                                "examples": [
                                    {
                                        "params": {
                                            "COMMAND": "make clean"
                                        }
                                    }
                                ],
                                "required": [
                                    "params"
                                ],
                                "properties": {
                                    "params": {
                                        "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/pipelineRunValues/properties/params",
                                        "type": "object",
                                        "title": "The params schema",
                                        "description": "Parameters to pass to the GHA workflow",
                                        "default": {},
                                        "examples": [
                                            {
                                                "COMMAND": "make clean"
                                            }
                                        ],
                                        "additionalProperties": true
                                    }
                                },
                                "additionalProperties": true
                            },
                            "triggerConditions": {
                                "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/triggerConditions",
                                "type": "object",
                                "title": "The triggerConditions schema",
                                "description": "Conditions to trigger the GHA workflow",
                                "default": {},
                                "examples": [
                                    {
                                        "fileChangesMatchAny": [
                                            "namespaces/domain-a/projects/example-a/**"
                                        ]
                                    }
                                ],
                                "required": [
                                    "fileChangesMatchAny"
                                ],
                                "properties": {
                                    "fileChangesMatchAny": {
                                        "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny",
                                        "type": "array",
                                        "title": "The fileChangesMatchAny schema",
                                        "description": "List of globs that will trigger the GHA workflow, if files change in the PR match any of these globs",
                                        "default": [],
                                        "examples": [
                                            [
                                                "namespaces/domain-a/projects/example-a/**"
                                            ]
                                        ],
                                        "additionalItems": true,
                                        "items": {
                                            "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny/items",
                                            "anyOf": [
                                                {
                                                    "$id": "#/properties/onPullRequestClose/items/anyOf/0/properties/triggerConditions/properties/fileChangesMatchAny/items/anyOf/0",
                                                    "type": "string",
                                                    "title": "File change matcher schema",
                                                    "description": "Glob to match files in the PR",
                                                    "default": "",
                                                    "examples": [
                                                        "namespaces/domain-a/projects/example-a/**"
                                                    ]
                                                }
                                            ]
                                        }
                                    }
                                },
                                "additionalProperties": true
                            }
                        },
                        "additionalProperties": true
                    }
                ]
            }
        }
    },
    "additionalProperties": true
}
